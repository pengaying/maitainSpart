var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var f=0;return function(){return f<b.length?{done:!1,value:b[f++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return f?f.call(b):$jscomp.arrayIterator(b)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,c){b!=Array.prototype&&b!=Object.prototype&&(b[f]=c.value)};
$jscomp.polyfill=function(b,f,c,d){if(f){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var a=b[d];a in c||(c[a]={});c=c[a]}b=b[b.length-1];d=c[b];f=f(d);f!=d&&null!=f&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:f})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function f(){this.batch_=null}function c(e){return e instanceof a?e:new a(function(a,d){a(e)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;f.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(e)};var d=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(e){d(e,0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var a=0;a<e.length;++a){var d=e[a];e[a]=null;try{d()}catch(g){this.asyncThrow_(g)}}}this.batch_=null};f.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var a=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{e(a.resolve,a.reject)}catch(k){a.reject(k)}};a.prototype.createResolveAndReject_=function(){function e(e){return function(c){d||(d=!0,e.call(a,c))}}var a=this,d=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};a.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof a)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var d=null!=e;break a;case "function":d=!0;break a;default:d=!1}d?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}};a.prototype.resolveToNonPromiseObj_=function(e){var a=void 0;try{a=e.then}catch(k){this.reject_(k);return}"function"==typeof a?
this.settleSameAsThenable_(a,e):this.fulfill_(e)};a.prototype.reject_=function(a){this.settle_(2,a)};a.prototype.fulfill_=function(a){this.settle_(1,a)};a.prototype.settle_=function(a,d){if(0!=this.state_)throw Error("Cannot settle("+a+", "+d+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=d;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)h.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var h=new f;a.prototype.settleSameAsPromise_=function(a){var e=this.createResolveAndReject_();a.callWhenSettled_(e.resolve,e.reject)};a.prototype.settleSameAsThenable_=function(a,d){var e=this.createResolveAndReject_();try{a.call(d,e.resolve,e.reject)}catch(g){e.reject(g)}};a.prototype.then=function(e,d){function c(a,e){return"function"==typeof a?function(e){try{b(a(e))}catch(q){h(q)}}:e}var b,h,m=new a(function(a,e){b=a;h=e});this.callWhenSettled_(c(e,b),c(d,h));return m};
a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.callWhenSettled_=function(a,d){function e(){switch(c.state_){case 1:a(c.result_);break;case 2:d(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?h.asyncExecute(e):this.onSettledCallbacks_.push(e)};a.resolve=c;a.reject=function(e){return new a(function(a,d){d(e)})};a.race=function(e){return new a(function(a,d){for(var b=$jscomp.makeIterator(e),h=b.next();!h.done;h=b.next())c(h.value).callWhenSettled_(a,
d)})};a.all=function(e){var d=$jscomp.makeIterator(e),b=d.next();return b.done?c([]):new a(function(a,e){function h(e){return function(d){m[e]=d;f--;0==f&&a(m)}}var m=[],f=0;do m.push(void 0),f++,c(b.value).callWhenSettled_(h(m.length-1),e),b=d.next();while(!b.done)})};return a},"es6","es3");function l(b){var f=0;return function(){return f<b.length?{done:!1,value:b[f++]}:{done:!0}}}function x(b){var f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return f?f.call(b):{next:l(b)}}
var y="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,A="function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,c){b!=Array.prototype&&b!=Object.prototype&&(b[f]=c.value)};function B(b,f){if(f){var c=y;b=b.split(".");for(var d=0;d<b.length-1;d++){var a=b[d];a in c||(c[a]={});c=c[a]}b=b[b.length-1];d=c[b];f=f(d);f!=d&&null!=f&&A(c,b,{configurable:!0,writable:!0,value:f})}}
B("Promise",function(b){function f(a){this.b=0;this.i=void 0;this.a=[];var e=this.g();try{a(e.resolve,e.reject)}catch(k){e.reject(k)}}function c(){this.a=null}function d(a){return a instanceof f?a:new f(function(e){e(a)})}if(b)return b;c.prototype.b=function(a){if(null==this.a){this.a=[];var e=this;this.g(function(){e.i()})}this.a.push(a)};var a=y.setTimeout;c.prototype.g=function(e){a(e,0)};c.prototype.i=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var d=0;d<a.length;++d){var c=
a[d];a[d]=null;try{c()}catch(g){this.h(g)}}}this.a=null};c.prototype.h=function(a){this.g(function(){throw a;})};f.prototype.g=function(){function a(a){return function(e){c||(c=!0,a.call(d,e))}}var d=this,c=!1;return{resolve:a(this.ua),reject:a(this.h)}};f.prototype.ua=function(a){if(a===this)this.h(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.wa(a);else{a:switch(typeof a){case "object":var d=null!=a;break a;case "function":d=!0;break a;default:d=!1}d?this.sa(a):
this.O(a)}};f.prototype.sa=function(a){var d=void 0;try{d=a.then}catch(k){this.h(k);return}"function"==typeof d?this.za(d,a):this.O(a)};f.prototype.h=function(a){this.P(2,a)};f.prototype.O=function(a){this.P(1,a)};f.prototype.P=function(a,d){if(0!=this.b)throw Error("Cannot settle("+a+", "+d+"): Promise already settled in state"+this.b);this.b=a;this.i=d;this.ra()};f.prototype.ra=function(){if(null!=this.a){for(var a=0;a<this.a.length;++a)h.b(this.a[a]);this.a=null}};var h=new c;f.prototype.wa=function(a){var d=
this.g();a.l(d.resolve,d.reject)};f.prototype.za=function(a,d){var e=this.g();try{a.call(d,e.resolve,e.reject)}catch(g){e.reject(g)}};f.prototype.then=function(a,d){function e(a,d){return"function"==typeof a?function(d){try{c(a(d))}catch(q){b(q)}}:d}var c,b,h=new f(function(a,d){c=a;b=d});this.l(e(a,c),e(d,b));return h};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.l=function(a,d){function e(){switch(c.b){case 1:a(c.i);break;case 2:d(c.i);break;default:throw Error("Unexpected state: "+
c.b);}}var c=this;null==this.a?h.b(e):this.a.push(e)};f.resolve=d;f.reject=function(a){return new f(function(d,e){e(a)})};f.race=function(a){return new f(function(e,c){for(var b=x(a),h=b.next();!h.done;h=b.next())d(h.value).l(e,c)})};f.all=function(a){var e=x(a),c=e.next();return c.done?d([]):new f(function(a,b){function h(d){return function(e){f[d]=e;m--;0==m&&a(f)}}var f=[],m=0;do f.push(void 0),m++,d(c.value).l(h(f.length-1),b),c=e.next();while(!c.done)})};return f});
var GTerrain=function(){function b(c,d){this.B=c;this.f=d}var f=2*Math.PI;b.prototype.B="";b.prototype.f=10;b.v=function(){function c(d,a,c,e,b){1==b&&(d=d*Math.PI/180,a=a*Math.PI/180,c=c*Math.PI/180,e=e*Math.PI/180);this.c=d;this.u=a;this.A=c;this.j=e;this.width=this.ha(this);this.height=this.ga(this)}c.prototype.ha=function(d){var a=d.A;d=d.c;a<d&&(a+=f);return a-d};c.prototype.ga=function(d){return d.j-d.u};c.contains=function(d,a,c){var e=d.c,b=d.A;b<e&&(b+=f,0>a&&(a+=f));return a>e&&a<b&&c>=
d.u&&c<=d.j};return c}();b.H=function(){function c(d,a,c){this.x=d;this.y=a;this.z=c}c.prototype.Aa=function(d,a){this.x=d*Math.PI/180;this.y=a*Math.PI/180;this.z=0};return c}();b.ba=function(){function c(){}c.fa=function(d,a,c,e,b,f,g,n){c-=g;b=g-b;f-=n;e-=n;var h=1/(f*c+b*e);a-=n;d-=g;g=(f*d+b*a)*h;c=(-e*d+c*a)*h;return new GTerrain.H(g,c,1-g-c)};return c}();b.G=function(){function c(){this.da=2;this.ea=1;this.K=new GTerrain.v(-180,-90,180,90,1)}c.prototype.N=function(d){return this.da<<d};c.prototype.o=
function(d){return this.ea<<d};c.prototype.V=function(d,a,c){var e=this.K,b=e.width/this.N(c);c=e.height/this.o(c);return new GTerrain.v(d*b+e.c,e.j-(a+1)*c,(d+1)*b+e.c,e.j-a*c)};c.prototype.T=function(d,a,c){var e=this.K;if(!GTerrain.v.contains(e,d,a))return null;var b=this.N(c);c=this.o(c);var h=e.width/b,g=e.height/c;e.A<e.c&&(d+=f);d=(d-e.c)/h|0;d>=b&&(d=b-1);a=(e.j-a)/g|0;a>=c&&(a=c-1);e=[];e[0]=Math.floor(d);e[1]=Math.floor(a);return e};c.prototype.ia=function(d,a,c){c=this.o(c);var e=[];e[0]=
d;e[1]=c-1-a;return e};return c}();b.$=function(){return function(c,d){this.s=c;this.qa=d}}();b.aa=function(){function c(){}c.prototype.L=null;c.prototype.M=null;c.prototype.J=null;return c}();b.Z=function(){return function(c,d){this.D=c;this.Da=d}}();b.X=function(){return function(c,d,a){this.s=c.s;this.D=d.D;this.C=a.C}}();b.Y=function(){return function(c,d,a){this.url=c;this.Ba=d;this.Ca=a}}();b.F=function(){function c(){this.S=0}c.prototype.xa=function(d){for(var a=[{key:"centerX",value:Float64Array.BYTES_PER_ELEMENT},
{key:"centerY",value:Float64Array.BYTES_PER_ELEMENT},{key:"centerZ",value:Float64Array.BYTES_PER_ELEMENT},{key:"minHeight",value:Float32Array.BYTES_PER_ELEMENT},{key:"maxHeight",value:Float32Array.BYTES_PER_ELEMENT},{key:"boundingSphereCenterX",value:Float64Array.BYTES_PER_ELEMENT},{key:"boundingSphereCenterY",value:Float64Array.BYTES_PER_ELEMENT},{key:"boundingSphereCenterZ",value:Float64Array.BYTES_PER_ELEMENT},{key:"boundingSphereRadius",value:Float64Array.BYTES_PER_ELEMENT},{key:"horizonOcclusionPointX",
value:Float64Array.BYTES_PER_ELEMENT},{key:"horizonOcclusionPointY",value:Float64Array.BYTES_PER_ELEMENT},{key:"horizonOcclusionPointZ",value:Float64Array.BYTES_PER_ELEMENT}],c=0,e={},b=0;b<a.length;b++){var f=a[b],g=f.value;e[f.key]=(8==g?d.getFloat64:d.getFloat32).call(d,c,!0);c+=g}return new GTerrain.$(e,c)};c.prototype.w=function(d){return d>>1^-(d&1)};c.prototype.na=function(d,a){var c=d.getUint32(a,!0);this.S=c;var b=new GTerrain.aa,f=new Uint16Array(c),k=new Uint16Array(c),g=new Uint16Array(c);
a+=Uint32Array.BYTES_PER_ELEMENT;for(var n=Uint16Array.BYTES_PER_ELEMENT,t=c*n,v=a,p=v+t,w=p+t,q=0,r=0,z=0,u=0;u<c;u++)q+=this.w(d.getUint16(v+n*u,!0)),r+=this.w(d.getUint16(p+n*u,!0)),z+=this.w(d.getUint16(w+n*u,!0)),f[u]=q,k[u]=r,g[u]=z;b.L=f;b.M=k;b.J=g;return new GTerrain.Z(b,a+3*t)};c.prototype.la=function(d,a,c,b){var e;2===b?e=new Uint16Array(d,a,c):e=new Uint32Array(d,a,c);for(a=d=0;a<e.length;++a)c=e[a],e[a]=d-c,0===c&&++d;return e};c.prototype.ma=function(d,a){var c=65536<this.S?Uint32Array.BYTES_PER_ELEMENT:
Uint16Array.BYTES_PER_ELEMENT;0!==a%c&&(a+=c-a%c);var b=d.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;b*=3;d=this.la(d.buffer,a,b,c);return{Ea:a+b*c,C:d}};c.prototype.decode=function(c){var a=new DataView(c);c=this.xa(a);var d=this.na(a,c.qa);a=this.ma(a,d.Da);return new GTerrain.X(c,d,a)};return c}();b.prototype.va=function(c,d){var a=new GTerrain.H(0,0,0);a.Aa(c,d);return a};b.prototype.ja=function(c){for(var d=[],a=0;a<c.length;a++){var b=c[a];d.push(this.va(b[1],b[0]))}return d};b.prototype.ta=
function(c,d,a){return(1-a)*c+a*d};b.prototype.m=function(c){return 0>c?0:1<c?1:c};b.prototype.R=function(c,d,a){var b=c.D,e=c.C;c=c.s;var f=b.L,k=b.M;b=b.J;for(var g=0,n=e.length;g<n;g+=3){var t=e[g],v=e[g+1],p=e[g+2],w=c.minHeight,q=c.maxHeight,r=GTerrain.ba.fa(d,a,f[t],k[t],f[v],k[v],f[p],k[p]);if(-1E-15<=r.x&&-1E-15<=r.y&&-1E-15<=r.z)return this.ta(w,q,(r.x*b[t]+r.y*b[v]+r.z*b[p])/32767)}return 0};b.prototype.ca=function(c,d,a){c=(new GTerrain.F).decode(c);return this.R(c,d,a)};b.prototype.I=
function(c,d){c=c*Math.PI/180;d=d*Math.PI/180;var a=new GTerrain.G,b=a.T(c,d,this.f),e=a.ia(b[0],b[1],this.f);e=this.B+"/"+this.f+"/"+e[0]+"/"+e[1]+".terrain";a=a.V(b[0],b[1],this.f);c=this.m((c-a.c)/a.width);c*=32767;d=this.m((d-a.u)/a.height);return new GTerrain.Y(e,c,32767*d)};b.prototype.oa=function(c,d){var a=new GTerrain.G,b,e=[],f={};for(b=0;b<c.length;++b){var k=a.T(c[b].x,c[b].y,this.f),g=k[0]+"_"+k[1];f.hasOwnProperty(g)||(k={x:k[0],y:k[1],level:this.f,W:a,U:[]},f[g]=k,e.push(k));f[g].U.push(c[b])}a=
[];for(b=0;b<e.length;++b)f=e[b],f=this.ya(f.x,f.y,f.level,f.W,d).then(this.ka(f)),a.push(f);return Promise.all(a,function(){return c})};b.prototype.ya=function(c,d,a,b,e){return e(this.B+"/"+a+"/"+c+"/"+(b.o(a)-d-1)+".terrain")};b.prototype.ka=function(c){var d=c.U,a=c.W.V(c.x,c.y,c.level),b=this;return function(c){c=(new GTerrain.F).decode(c);for(var e=0;e<d.length;++e){var f=d[e],h=b.m((f.x-a.c)/a.width);h*=32767;var n=b.m((f.y-a.u)/a.height);n*=32767;h=b.R(c,h,n);f.z=h}}};b.prototype.pa=function(c,
b,a){this.oa(c,b).then(function(){a&&a(c)})};return b}();GTerrain.prototype.convertToP3dArray=function(b){return this.ja(b)};GTerrain.prototype.getHeight=function(b,f,c){var d=this,a=this.I(b,f);(function(a){return window.fetch(a,{headers:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9"}}).then(function(c){if(200!==c.status)throw Error("Unable to load tile "+a);return c.arrayBuffer()})})(a.url).then(function(b){b=d.ca(b,a.Ba,a.Ca);c&&c(b)})};
GTerrain.prototype.getHeights=function(b,f){this.pa(b,function(c){return window.fetch(c,{headers:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9"}}).then(function(b){if(200!==b.status)throw Error("Unable to load tile "+c);return b.arrayBuffer()})},f)};var R=6371E3;
GTerrain.prototype.distanceBetween=function(b,f){var c=Math.PI/180,d=Math.sin((f[1]-b[1])*c/2),a=Math.sin((f[0]-b[0])*c/2);b=d*d+Math.cos(b[1]*c)*Math.cos(f[1]*c)*a*a;return 2*R*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))};GTerrain.prototype.formatPositon=function(b){var f={};f.y=Number(180*b.y/Math.PI).toFixed(6);f.x=Number(180*b.x/Math.PI).toFixed(6);f.z=Number(b.z.toFixed(1));return f};
GTerrain.prototype.getLineHeights=function(b,f,c,d){var a=this.distanceBetween(b,f);c=Math.floor(a/c);a=[];for(var h=0;h<=c;h++){var e=h/c;a.push(this.va((1-e)*b[1]+e*f[1],(1-e)*b[0]+e*f[0]))}this.getHeights(a,d)};
GTerrain.prototype.getLineVisible=function(b,f,c,d,a,h,e,m){b=[b,f];d=[d,a];a=this.distanceBetween(b,d);var k=Math.floor(a/e);e=[];for(a=0;a<=k;a++)f=a/k,e.push(this.va((1-f)*b[0]+f*d[0],(1-f)*b[1]+f*d[1]));this.getHeights(e,function(a){var b=[],d=[],e=[];d[0]=0;e[0]=1;var f=[180*a[0].x/Math.PI,180*a[0].y/Math.PI,a[0].z];a[0].z+=c;a[k].z+=h;for(var g=1;g<a.length;g++){var q=this.distanceBetween(f,[180*a[g].x/Math.PI,180*a[g].y/Math.PI,a[g].z]);var r=a[g].z-a[0].z;q=180*Math.atan(r/q)/Math.PI+90;b.push(q);
1==g?(d[g]=q,e[g]=1):q>=d[g-1]?(d[g]=q,e[g]=1):(e[g]=0,d[g]=d[g-1])}b=[];d=1;for(g=2;g<e.length;g++)e[g]!=d&&(b.push(g),d=(d+1)%2);m&&m(a,b)})};
GTerrain.prototype.drawVisibleLine=function(b,f,c){for(var d=1,a=[180*b[0].y/Math.PI,180*b[0].x/Math.PI],h,e,m=0;m<f.length;m++){e=f[m];h=[180*b[e].y/Math.PI,180*b[e].x/Math.PI];var k=[a,h];if(1==d){var g="green";d=0}else d=1,g="red";c(k,g);a[0]=h[0];a[1]=h[1]}e<b.length&&(k=[h,[180*b[b.length-1].y/Math.PI,180*b[b.length-1].x/Math.PI]],g="red",1==d&&(g="green"),c(k,g))};
GTerrain.prototype.terrainPolyline=function(b){var f=b.positions,c=[],d=R*(b.granularity||1E-5),a=this.distanceBetween([f[0].lng,f[0].lat],[f[1].lng,f[1].lat]);d=Math.floor(a/d);for(a=0;a<=d;a++){var h=a/d;c.push(this.va((1-h)*f[0].lng+h*f[1].lng,(1-h)*f[0].lat+h*f[1].lat))}this.getHeights(c,b.calback)};var myChart1;
GTerrain.prototype.setEchartsData=function(b,f,c){if(null!=b&&null!=b.arrPoint){$(f).show();null==myChart1&&(myChart1=echarts.init(document.getElementById(c),"dark"));var d=b.arrPoint;b={grid:{left:10,right:10,bottom:10,containLabel:!0},dataZoom:[{type:"inside",throttle:50}],tooltip:{trigger:"axis",formatter:function(a){if(0==a.length)return"";a[0].value;var c=d[a[0].dataIndex];return"\u6240\u5728\u4f4d\u7f6e&nbsp;"+c.x+","+c.y+"<br />\u8ddd\u8d77\u70b9&nbsp;<label>"+haoutil.str.formatLength(a[0].axisValue)+
"</label><br />"+a[0].seriesName+"&nbsp;<label style='color:"+a[0].color+";'>"+haoutil.str.formatLength(a[0].value)+"</label><br />"}},xAxis:[{name:"\u884c\u7a0b",type:"category",boundaryGap:!1,axisLine:{show:!1},axisLabel:{show:!1},data:b.arrLen}],yAxis:[{type:"value",axisLabel:{rotate:60,formatter:"{value} \u7c73"}}],series:[{name:"\u9ad8\u7a0b\u503c",type:"line",smooth:!0,symbol:"none",sampling:"average",itemStyle:{normal:{color:"rgb(255, 70, 131)"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,
0,0,1,[{offset:0,color:"rgb(255, 158, 68)"},{offset:1,color:"rgb(255, 70, 131)"}])}},data:b.arrHB}]};myChart1.setOption(b)}};
GTerrain.prototype.updateSectionForTerrain=function(b,f,c,d){function a(){m++;h.terrainPolyline({positions:[e[m-1],e[m]],granularity:f,calback:function(b,f){for(f=0;f<b.length;f++){0!=f&&(k+=h.distanceBetween([180*b[f].x/Math.PI,180*b[f].y/Math.PI],[180*b[f-1].x/Math.PI,180*b[f-1].y/Math.PI]));g.push(Number(k.toFixed(1)));var p=h.formatPositon(b[f]);n.push(p.z);t.push(p)}m>=e.length-1?h.setEchartsData({arrLen:g,arrHB:n,arrPoint:t},c,d):a()}})}var h=this,e=b;if(!(2>e.length)){var m=0,k=0,g=[],n=[],
t=[];a()}};GTerrain.prototype.getAngleForTerrain=function(b,f,c){function d(){e++;a.terrainPolyline({positions:[h[e-1],h[e]],granularity:f,calback:function(b,f){for(var g,n=[],p=1;p<b.length;p++)f=a.distanceBetween([180*b[p].x/Math.PI,180*b[p].y/Math.PI],[180*b[p-1].x/Math.PI,180*b[p-1].y/Math.PI]),g=b[p].z-b[p-1].z,n.push(180*Math.atan(g/f)/Math.PI);m.push(b);k.push(n);e>=h.length-1?c&&c(m,k):d()}})}var a=this,h=b;if(!(2>h.length)){var e=0,m=[],k=[];d()}};
var m_grades=[50,40,20,10,-10,-30,-50],m_colors="#800026 #BD0026 #E31A1C #FC4E2A #FD8D3C #FEB24C #FED976 #FFEDA0".split(" "),m_legend=null;GTerrain.prototype.createPaletteFromGrade=function(b,f){for(var c=b[0]-b[b.length-1],d={},a=0;a<b.length;a++)d[(b[a]-b[b.length-1])/c]=f[a];d[0]=f[b.length];return d};
GTerrain.prototype.drawAngleLines=function(b,f,c){for(var d=0;d<b.length;d++){for(var a=b[d],h=f[d],e=[],m=0;m<a.length;m++){var k=180*a[m].y/Math.PI,g=180*a[m].x/Math.PI,n=0;0<m&&(n=h[m-1]);e.push([k,g,n])}a=new GMap.Hotline(e,{min:-50,max:50,palette:this.createPaletteFromGrade(m_grades,m_colors),weight:10,outlineColor:"#000000",outlineWidth:0,noClip:!0,smoothFactor:0});c.addLayer(a)}null==m_legend&&(m_legend=this.addAngleLegend(m_grades,m_colors,c))};
GTerrain.prototype.addAngleLegend=function(b,f,c){var d=GMap.control({position:"bottomleft"});d.onAdd=function(a){a=GMap.DomUtil.create("div","info legend");var c='<tr><td><i style="background:'+f[0]+'"></i></td><td> > '+b[0]+"</td></tr> ";var d="<table>"+c;for(var m=1;m<b.length;m++){var k=b[m-1];var g=b[m];c='<tr><td><i style="background:'+f[m]+'"></i></td><td> ';c=c+k+(g?"&ndash;"+g:"+")+"</td></tr>";d+=c}c='<tr><td><i style="background:'+f[b.length-1]+'"></i></td><td> < '+b[b.length-1]+"</td></tr> ";
a.innerHTML=d+c+"</table>";return a};d.addTo(c);return d};
